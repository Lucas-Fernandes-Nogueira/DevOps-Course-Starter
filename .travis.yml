services:
  - docker
env:
  global:
  - DOCKER_ID=lucnog
  - BOARD_ID=5ef102923967ff06c7504e0a
  - FLASK_APP=app
  - FLASK_ENV=development
  - secure: "azmepD9k5MyQeNX8fhFGiZBGMcMBS394BsgTQtPkziWm6ABXD6QuK5vYmSHyLx4HxnPM6qS/ySxPxply2Lbf/bNj/uY3NafuIj8q2b8ZC9DtGkemE8QuROmoTIL57TayFAjLfbuPhDA/cSidMx/alup56C6SoPP+O5RWrX/XzaHggx8sRGExnfk1rSnmYFbuprESy7L3TJAyrM+7/Ww2Q0iuphTtPUp4/JZyecZL6cyYSI6pS2NRuUSHqbozG6SWZn0/PtnMMhhDc0tjZW6w5FB3Jwwnfrz9Zhis4MFzaQWeCdhhsFw6jL2U59a9eJZRVPoEnBPBiBkVLDZCjH926Emun/9cdA+nA6vj2YBgwT2jAoLUPkwok+OJQVPp34sOxrrLDG6mXXzvVyxSZ5ZLLUpEbZrS6V4KOXS4leShWiFL4oYF99bK5tVIj/81G8u1PYkVGVf1Hb6DMEXHTHHtr+a9nCgJ2WNbR8efyfd6WDBzoTxsglfJZvTCej0FOcyEHSJx9heA3Nc4OAdOWmWH6noYIn6hYSAbWsFC6Z3x7NwrvANBOse1bgWlOa2J6HJCKeI9J07OEH73ovgEVtUT0sCctGall5w5RONg4HFrmiyMjteV2kGbSBsYG1mi6cDDGBU325YUIMY1iF35FfteOc2EyJKqiqmuxEbxk4auGrw="
  - secure: "ftig8aPk8avtgzOJUHkt5aQm6iwjC1gYtxPBIVO2fnjCXqfes1HzYEKJeygO7v9BTJ1fa5k4BX0hH09waKD23eLq3+U83DlfO8pbM0jVFoO3qc8YwUYF2MDaUIDvjWv05gI5mpHCeorYnp9FjBOKeaSbEbZuxO9p/54xyrFe3tXrBzv3OFYLzbjw+6NH8sXWsLIiF8oBZolLrPp14fpzIC4hd5ogpP3OqHtnKGkm/gDhQct+pl72laBT/GuWpcf0ul/te5WLfo1SJXuGZpi5xCvWL25u/HCGVx1HGwJWtRLK77dsVpPYOnzmz6HnJ990CYu+og4s/5LQzWDvx1TdOMlYy1k5BWRBJyF2cvc91SBl0uK7grkWS4pKSn0QM0zhEc7JtrdwuebflxjinLC1T3o2MWg8bwbtCKyvKTG9ZdVtKKdgY6FdEt91AUlE7DtglwtstAMUnkfeHeQRIHIlLvptsAwoFZxHOh0uiVM3h7hpMl41eElKuFivwi0P2TDcKuNCg4ZCgL1Styryust98e8qBXAttVDgvJf76Hbn7vPWMP59gYjrBvrvng1DYgwXVgS7Pf/JkO1DvDozSk9Ll1Q/yoNXj4WRimXuCzuRb4yb/u4QL3Az7iDdStC/JMyI6as3ZrwsIDMf7JmW7f7XTEpb0YCOdBIEE08mfpP/ByE="
  - secure: "Rm34yAkJplhsvsd0Wc6kI/0fASwx1jbNX8GQ7EeHU2W+C63i3jtm/yo76YtSqNiL6Ikf0FZNKKWNAz5csc+tE0MmEDDss+QnDvdmBGW02VLplOcruwNwT5lX/iFc8rMqfVtO/06kWQNgi831mggqB7ZfcXeJqxuc7tiXG7gOnm7kbd3OCQcY9xtdoHnxh1Tc55miSUPi/tsF44aM1b/2RjjZA27ECM2HBM9KV5qqPCwQ5Qw6tZ7g7iWyV1V1T7Xeqqx7S8x1CeNx1dDRR24bcm25n06bVhs+XBMz8TdXMXfujAEVilSoEXh0TvAzIr53SCRUUR2WHKKUDukdGPGad9ErcFjZU41gwTlY+X9VH8T3mnVHfA234KF/o5JppdFV2S7xzp8E9CYX9iuhXzbDbJsDh4dgpAB90r9EHrLVzzrETy9BkfRw01OQQsfo8B36Fa+X46JT2nwId+2pe1K93w3MSldAA4/jZcGvIA6UNhf61J2tTHYqU65n37HOGI5o0SBlh4QcmT7D5UAaT/KdOJOAb+hvqON9E3YXpvprzc1cexfdYvq75GP+SNajnL+okWxduy6MhjZcg2AAgJ1/XlsMfs6AJApbTA3TjGlwALAhgBg/ZK4Yk3vGVd4iwUvsSnxNd8NB6Evq5yOqgfcUtw3I71ERIzGQTuIdytqN9bQ="
  - secure: "SMQR+WxtSViJ5NvERGMLAa3Saend7ReSA2BcPxu9HIWsDILa+J7Iqa2jK40SMzCUH/gOFMpCfvoarKZxPWiHQ1kms9LKTl5dVx6/OcGWTdfUq0G7xncpGxTL2NTygE2gJojXOCUlq0qhoCl3nCBKRBBhCcuiceDq75sBcVCziB50pdPjW5DemnPn22O3wo/aqPA/eadDw8eXm/RXzvdFnIoBKpaaM/3qqloLvBu3uzHpjEdxZ6jLEcvgJyoJHZq/LlnkbEM36+1pF8yZXtoPjYnWZOwT5lxollw2w6ipIQkwsLiMA4F7UufsId3hZWKslybft6GXDMF1ayZ7oU/nP7mS5YyChlWlxflVEhNvmQXSw8CxZ7Haiz5Mn2HOo/hhRG6j43VeLkcM7hH6xkskfYbIuRCCEi6AGK2dCczz4jke91iyYkXLHC8/fCWLTOhQAgE8/ifeh97koP1gs0V6VeLogdbKvyUMbV1ATc3DaPHHWerNOHj/K1A7kRLJAY9+SPPUle1haErlaLVTmvbmyZP60JBTEl+Pv+I9ynhPyap+L0XNq2gXREtkjAzGRbdbTn1XYNOzdnqcgi461czZFhfSgI6b4bvkX++kXsWwu66SMw66/Fr9ayphbzHT1yCD2ZAG+NKYEPthY43p0+BlVB8keZ8t0g15Kjhda2njh1s="
script:
  - docker build --target test --tag todo-app:test .
  - docker run -e API_KEY=$API_KEY -e TOKEN=$TOKEN -e FLASK_APP=$FLASK_APP -e FLASK_ENV=$FLASK_ENV todo-app:test test_e2e.py
  - docker run todo-app:test test_app.py
  - docker run todo-app:test test_indexViewModel.py
deploy:
  - provider: script
    script: 
      - echo $DOCKER_PASSWORD | docker login -u $DOCKER_ID --password-stdin
      - docker build --target production --tag lucnog/todo-app:$TRAVIS_COMMIT .
      - docker push lucnog/todo-app:$TRAVIS_COMMIT
      - docker tag lucnog/todo-app:$TRAVIS_COMMIT lucnog/todo-app:latest
      - docker push lucnog/todo-app:latest
      - docker tag lucnog/todo-app:latest registry.heroku.com/devops-todo-app/web
      - heroku container:login
      - docker push registry.heroku.com/devops-todo-app/web
      - heroku container:release web --app devops-todo-app
    on:
      branch: master
